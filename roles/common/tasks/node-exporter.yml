- name: Check Exporter does exit
  stat:
    path: /opt/node_exporter
  register: out

- name: debug
  debug:
    msg: "{{out}}"

- name: debug
  debug:
    msg: "{{NODE_EXPORTER_URL | split('/') | last | regex_replace('.tar.gz', ' ') }}"

#- name: Download and Extract
#  ansible.builtin.unarchive:
#    src: "https://github.com/prometheus/node_exporter/releases/download/v1.4.0-rc.0/node_exporter-1.4.0-rc.0.linux-amd64.tar.gz"
#    dest: /tmp
#    remote_src: yes
#
#- name: copy Node Exporter to /opt
#  copy:
#    src: /tmp/node_exporter-1.4.0-rc.0.linux-amd64
#    dest: /opt/node_exporter
#    remote_src: yes




##!/bin/bash
#
#if [ $(id -u) -ne 0 ]; then
#  echo "You should run as root user"
#  exit 1
#fi
#
#if [ -d /opt/node_exporter ]; then
#  rm -rf /opt/node_exporter
#  systemctl enable node_exporter
#  systemctl start node_exporter
#  exit 0
#fi
#
#URL=$(curl -L -s https://prometheus.io/download/  | grep tar | grep node_exporter | grep linux-amd64  | sed -e "s|>| |g" -e 's|<| |g' -e 's|"| |g' |xargs -n1 | grep ^http | head -1)
#
#FILENAME=$(echo $URL | awk -F / '{print $NF}')
#DIRNAME=$(echo $FILENAME | sed -e 's/.tar.gz//')
#
#cd /opt
#curl -s -L -O $URL
#tar -xf $FILENAME
#rm -f $FILENAME
#mv $DIRNAME node_exporter
#
#curl -s https://raw.githubusercontent.com/linuxautomations/labautomation/master/tools/prometheus-node-exporter/prometheus.service >/etc/systemd/system/node_exporter.service
#systemctl enable node_exporter
#systemctl start node_exporter
#
#3.235.100.154 | 172.31.13.128 | t3.micro | https://github.com/linuxautomations/labautomation.git
#[ centos@prometheus /tmp/labautomation/tools/prometheus-node-exporter ]$
